!function(o,d){MapSVG.galleryApiLoaded||o(document).ready(function(){o("body").append(o('<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><button class="pswp__button pswp__button--share" title="Share"></button><button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button><button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div>')),MapSVG.galleryApiLoaded=!0,Handlebars.registerHelper("mapsvg_gallery",function(t,e){if(e){e.full&&void 0===e.length&&(e=[e]);var a,s="",i=(t=(t+="").split("."))[0],n=t[1];return MapSVG.getById(i).getData().options.galleries.forEach(function(t){t.id==n&&(a=t)}),type=a.type,s+='<div class="mapsvg-gallery-wrap" style="background-color: '+a.background+'"><div class="mapsvg-gallery mapsvg-gallery-'+type+" "+("multi"==type||"justified"==type?" mapsvg-gallery-justified ":"")+(a.lightbox?" mapsvg-gallery-lightbox ":"")+'itemscope itemtype="http://schema.org/ImageGallery"'+("original"==a.type||"justified"==a.type||"multi"==a.type?' data-thumb-margins="'+a.thumb_margin.replace("px","")+'"':"")+" "+("original"==a.type||"justified"==a.type||"multi"==a.type?' data-thumb-height="'+a.thumb_height.replace("px","")+'"':"")+" >",e.forEach(function(t,e){var i,n=!0;"multi"==a.type?(i=t.thumbnail,n=!1):"justified"==a.type?(i=t.medium,n=!0):(i=(0!==e||"single"!=type&&"combo"!=type)&&"slider"!=type?(n=!1,t.thumbnail):(n=!0,t.full),i=0===e&&("single"==type||"combo"==type)||"slider"==type?t.full:t.thumbnail),s+='<figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">                    <a href="'+t.full+'" itemprop="contentUrl" data-size="'+t.sizes.full.width+"x"+t.sizes.full.height+'">                        \x3c!--alt="Image description"--\x3e                        \x3c!--padding: '+a.thumb_margin+';--\x3e                        <img src="'+i+'" style="'+("slider"==type&&a.max_height?"max-height: "+a.max_height+"px":"")+'" itemprop="thumbnail"  '+(n?"":'width="'+a.thumb_width+'"')+'/>                    </a>                    <figcaption itemprop="caption description">'+t.caption+"</figcaption>                    </figure>"}),s+="</div>","single"==type&&a.lb_button_show&&(s+='<button class="mapsvg-gallery-button">'+a.lb_button_text.replace("{{counter}}",e.length)+"</button>"),s+="</div>",new Handlebars.SafeString(s)}})});function a(t,e){function r(t,e){return t&&(e(t)?t:r(t.parentNode,e))}function i(t){(t=t||d.event).preventDefault?t.preventDefault():t.returnValue=!1;var t=t.target||t.srcElement,e=r(t,function(t){return t.tagName&&"FIGURE"===t.tagName.toUpperCase()});if(e){for(var i,t=o(e).closest(".mapsvg-gallery")[0],n=o(e).closest(".mapsvg-gallery").find("figure"),a=n.length,s=0,l=0;l<a;l++)if(1===n[l].nodeType){if(n[l]===e){i=s;break}s++}return 0<=i&&p(i,t),!1}}for(var p=function(t,e,i,n){var a=document.querySelectorAll(".pswp")[0],s=function(t){for(var e,i,n,a=t,s=a.length,l=[],r=0;r<s;r++)1===(e=a[r]).nodeType&&(n=(i=e.children[0]).getAttribute("data-size").split("x"),n={src:i.getAttribute("href"),w:parseInt(n[0],10),h:parseInt(n[1],10)},1<e.children.length&&(n.title=e.children[1].innerHTML),0<i.children.length&&(n.msrc=i.children[0].getAttribute("src")),n.el=e,l.push(n));return l}(o(e).find("figure")),l={galleryUID:e.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(t){var e=s[t].el.getElementsByTagName("img")[0],t=d.pageYOffset||document.documentElement.scrollTop,e=e.getBoundingClientRect();return{x:e.left,y:e.top+t,w:e.width}},shareEl:!1,captionEl:!0};if(n)if(l.galleryPIDs){for(var r=0;r<s.length;r++)if(s[r].pid==t){l.index=r;break}}else l.index=parseInt(t,10)-1;else l.index=parseInt(t,10);isNaN(l.index)||(i&&(l.showAnimationDuration=0),new PhotoSwipe(a,PhotoSwipeUI_Default,s,l).init())},n=document.querySelectorAll(t),a=0,s=n.length;a<s;a++)n[a].setAttribute("data-pswp-uid",a+1),n[a].onclick=i,o(".mapsvg-gallery-button").on("click",function(){p(0,o(this).parent().find(".mapsvg-gallery")[0])});(t=function(){var t=d.location.hash.substring(1),e={};if(t.length<5)return e;for(var i,n=t.split("&"),a=0;a<n.length;a++)n[a]&&((i=n[a].split("=")).length<2||(e[i[0]]=i[1]));return e.gid&&(e.gid=parseInt(e.gid,10)),e}()).pid&&t.gid&&p(t.pid,n[t.gid-1],!0,!0)}var p;o(d).on("shown.popover",function(t,e,i){o(i.containers.view).find(".mapsvg-gallery-lightbox").length&&a(".mapsvg-gallery-lightbox");var n=o(i.containers.view).find(".mapsvg-gallery-slider");n.length&&n.slick({dots:!0});i=o(i.containers.view).find(".mapsvg-gallery-justified");i&&i.justifiedGallery({selector:"figure, div:not(.spinner)",margins:i.data("thumb-margins")||2,rowHeight:i.data("thumb-height")||100})}),o(d).on("shown.detailsView",function(t,e,i){o(i.containers.view).find(".mapsvg-gallery-lightbox").length&&a(".mapsvg-gallery-lightbox");var n=o(i.containers.view).find(".mapsvg-gallery-slider");n.length&&n.slick({dots:!0});i=o(i.containers.view).find(".mapsvg-gallery-justified");i&&i.justifiedGallery({selector:"figure, div:not(.spinner)",margins:i.data("thumb-margins")||2,rowHeight:i.data("thumb-height")||100})}),(p=d.jQuery||d.Zepto).fn.unveil=function(t,e){var i,a=p(d),s=t||0,n=1<d.devicePixelRatio?"data-src-retina":"data-src",l=this;function r(){var t=l.filter(function(){var t=p(this);if(!t.is(":hidden")){var e=a.scrollTop(),i=e+a.height(),n=t.offset().top,t=n+t.height();return e-s<=t&&n<=i+s}});i=t.trigger("unveil"),l=l.not(i)}return this.one("unveil",function(){var t=this.getAttribute(n);(t=t||this.getAttribute("data-src"))&&(this.setAttribute("src",t),"function"==typeof e&&e.call(this))}),a.on("scroll.unveil resize.unveil lookup.unveil",r),r(),this}}(jQuery,window);
!function(r,t){jQuery(document).ready(function(){setTimeout(function(){MapSVG.admin.addController("Gallery","gallery","tab_actions")},1e3)});function e(t,e,a){this.name="gallery",this.scrollable=!1,this.isParent=!0,this.templatesURL=mapsvg_gal_paths.templates,r("#"+t).empty(),MapSVGAdminController.call(this,t,e,a)}t.MapSVGAdminGalleryController=e,MapSVG.extend(e,t.MapSVGAdminController),e.prototype.viewLoaded=function(){var t=this;this.controllers.list=new MapSVGAdminGalleryListController("mapsvg-gal-list",t.admin,t.mapsvg),this.controllers.list.toolbarView=this.toolbarView,t.activeController=this.controllers.list},e.prototype.viewDidAppear=function(){MapSVGAdminController.prototype.viewDidAppear.call(this)},e.prototype.viewDidDisappear=function(){MapSVGAdminController.prototype.viewDidDisappear.call(this),this.admin.restorePanelsState()},e.prototype.setEventHandlers=function(){var a=this;r("#mapsvg-gal-tabs a").on("shown.bs.tab",function(t){var e=r(r(this).attr("href")).data("controller");(a.activeController=e).viewDidAppear();t=r(t.relatedTarget).attr("href");t&&(t=r(t).attr("data-controller"),a.controllers[t].viewDidDisappear()),"#mapsvg-gal-list"==r(this).attr("href")&&r(".mapsvg-toolbar-buttons").show()})}}(jQuery,window);
!function(s,e,i){function t(e,t,a){this.name="gallery-list",this.schema=new i.schema({fields:[{name:"id",label:"ID",visible:!1,type:"id"},{name:"type",label:"Gallery type",visible:!0,type:"radio",options:[{label:"Original thumbnails",value:"original"},{label:"Square thumbnails",value:"multi"},{label:"Justified thumbnails",value:"justified"},{label:"First image only",value:"single"},{label:"Slider",value:"slider"}]},{name:"background",label:"Gallery: background color",visible:!0,placeholder:"#EEEEEE",type:"colorpicker"},{name:"thumb_width",label:"Thumbnails: width",visible:!0,placeholder:"50",type:"text"},{name:"thumb_height",label:"Thumbnails: height",visible:!0,placeholder:"50",type:"text"},{name:"thumb_margin",label:"Thumbnails: margin",visible:!0,placeholder:"3",type:"text"},{name:"max_height",label:"Slider: max-height",visible:!0,type:"text",placeholder:"250"},{name:"lightbox",label:"Lightbox",visible:!0,type:"checkbox",help:"Open lightbox on click on a thumbnail.",value:1},{name:"lb_button_show",label:"Lightbox: button",visible:!0,type:"checkbox",help:'Add lightbox opening button into the gallery. Usable only for "First image" gallery type.'},{name:"lb_button_text",label:"Lightbox: button text",visible:!0,type:"text",value:"View all ({{counter}})",help:'You can use {{counter}} tag inside of the button text to show total number of photos. Example: "View all {{counter}}"'}]}),this.templatesURL=mapsvg_gal_paths.templates,MapSVGAdminController.call(this,e,t,a),this.mapsvg.options.galleries?this.mapsvg.options.galleries instanceof i.arrayIndexed||(this.mapsvg.options.galleries=new i.arrayIndexed("id",this.mapsvg.options.galleries,{autoId:!0})):this.mapsvg.options.galleries=new i.arrayIndexed("id",[],{autoId:!0})}e.MapSVGAdminGalleryListController=t,MapSVG.extend(t,e.MapSVGAdminController),t.prototype.viewLoaded=function(){this.redrawDataList()},t.prototype.viewDidAppear=function(){MapSVGAdminController.prototype.viewDidAppear.call(this),this.database.setSchema()},t.prototype.viewDidDisappear=function(){MapSVGAdminController.prototype.viewDidDisappear.call(this),this.closeFormHandler()},t.prototype.setEventHandlers=function(){var a,i=this;s("#mapsvg-btn-gallery-add").on("click",function(e){e.preventDefault(),i.btnAdd=s(this),i.btnAdd.addClass("disabled"),i.editDataRow()}),this.view.on("mousedown",".mapsvg-data-row",function(e){a=MapSVG.mouseCoords(e)}),this.view.on("mouseup",".mapsvg-data-row",function(e){var t=MapSVG.mouseCoords(e);if(a.x==t.x){if(s(e.target).hasClass("mapsvg-copy-shortcode")||s(e.target).parent().hasClass("mapsvg-copy-shortcode")){t=s(e.target).parent().data("shortcode"),e=document.createElement("textarea");return e.value=t,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),void s.growl.notice({title:"",message:"Tag copied to clipboard",duration:700})}s(this).hasClass("active")||i.editDataRow(s(this))}}).on("mouseup",".mapsvg-gallery-delete",function(e){e.preventDefault(),e.stopPropagation();e=s(this).closest("tr");i.deleteDataRow(e)})},t.prototype.getTemplateData=function(){var e=this;return{fields:e.getDataFieldsForTemplate(!0),data:e.mapsvg.options.galleries,map_id:e.mapsvg.id}},t.prototype.getDataFieldsForTemplate=function(e){return this.schema},t.prototype.redrawDataList=function(){var e=this;e.redraw();var t=this.mapsvg.getPagination(function(){e.redrawDataList()});this.view.find(".mapsvg-pagination-container").html(t)},t.prototype.getObjectRow=function(e){return this.view.find("#mapsvg-gallery-row-"+e.id)},t.prototype.addDataRow=function(e){e={fields:this.schema.getColumns({visible:!0}),params:e,map_id:this.mapsvg.id},e=s(this.templates.item(e));return this.view.find("#mapsvg-gallery-list-table tbody").prepend(e),e},t.prototype.updateDataRow=function(e,t){var a={fields:this.schema.getColumns({visible:!0}),params:e,map_id:this.mapsvg.id},i=s(this.templates.item(a));(t=t||s("#mapsvg-gallery-row-"+e.id)).replaceWith(i),i.addClass("mapsvg-row-updated"),setTimeout(function(){i.removeClass("mapsvg-row-updated")},2600)},t.prototype.deleteDataRow=function(e){var t=e.data("id"),a=this.mapsvg.options.galleries.get(t);if(!a)return!1;a.marker&&this.mapsvg.markerDelete(a.marker),this.mapsvg.options.galleries.delete(t),e.fadeOut(300,function(){e.remove()})},t.prototype.editDataRow=function(e,t){var a=this,i=!e,o={};a.tableDataActiveRow&&a.tableDataActiveRow.removeClass("mapsvg-row-selected"),o=e?(a.updateScroll(),t&&a.contentWrap.data("jsp").scrollToElement(e,!0,!1),a.tableDataActiveRow=e,a.tableDataActiveRow.addClass("mapsvg-row-selected"),l=a.tableDataActiveRow.data("id"),this.mapsvg.options.galleries.get(l)):{type:"multi",thumb_width:50,thumb_height:50,thumb_margin:3,max_height:250,lightbox:!0};var l=wp.media.frames.file_frame=wp.media({title:"Choose images",button:{text:"Choose images"},multiple:!0});a.formBuilder&&(a.formBuilder.destroy(),a.formBuilder=null,a.formBuilderRow&&a.formBuilderRow.remove(),s("#mapsvg-btn-gallery-add").removeClass("disabled")),a.formContainer&&a.formContainer.empty().remove(),a.formContainer=s('<div class="mapsvg-modal-edit"></div>'),this.view.append(a.formContainer),a.formBuilder=this.mapsvg.createForm({container:a.formContainer,schema:a.schema,editMode:!1,mapsvg:a.mapsvg,mediaUploader:l,data:o,admin:a.admin,events:{save:function(e,t){i?a.saveDataObject(t):a.updateDataObject(t),this.close()},close:function(){a.closeFormHandler()}}})},t.prototype.saveDataObject=function(e){var t,a;(t=e.id?this.getObjectRow(e):t)&&t.length||(a=!0,t=this.addDataRow(e)),a?(this.mapsvg.options.galleries.push(e),this.updateDataRow(e,t)):(this.mapsvg.options.galleries.update(e),this.closeFormHandler(),this.updateDataRow(e))},t.prototype.updateDataObject=function(e){this.mapsvg.options.galleries.update(e),this.closeFormHandler(),this.updateDataRow(e)},t.prototype.closeFormHandler=function(){var e=this;s("#mapsvg-btn-gallery-add").removeClass("disabled"),e.mapsvg.showMarkers(),e.formBuilder&&(e.formBuilder.destroy(),e.formBuilder=null,e.formContainer.empty().remove(),e.tableDataActiveRow&&e.tableDataActiveRow.removeClass("mapsvg-row-selected"),e.tableDataActiveRow&&!e.tableDataActiveRow.hasClass("mapsvg-row-updated")&&e.tableDataActiveRow.addClass("mapsvg-row-closed"),setTimeout(function(){e.tableDataActiveRow&&!e.tableDataActiveRow.hasClass("mapsvg-row-updated")&&e.tableDataActiveRow.removeClass("mapsvg-row-closed")},1600),s("a.browser").remove()),this.updateScroll()}}(jQuery,window,mapsvg);